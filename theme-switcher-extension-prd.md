# 🌙 浏览器网页通用主题切换插件 - 产品需求文档（PRD）

## 一、产品概述

### 1.1 产品名称
> 浏览器网页通用主题切换插件（暂定名）

### 1.2 产品目标
- 减少网页高亮背景带来的视觉疲劳
- 快速一键切换网页主题色
- 支持网页懒加载内容的动态处理
- 针对不同网站可设置独立主题
- 兼容浏览器深色偏好设置

## 二、产品背景与用户画像

### 2.1 背景
在日常办公、阅读或浏览网页时，纯白色背景或高亮色彩常造成视觉疲劳，特别在夜间或低亮环境中体验更差。用户希望能通用地对所有网页内容进行美化和个性化设置，改善浏览体验。

### 2.2 目标用户
> 所有使用桌面端浏览器访问网页内容的用户。包括但不限于学生、办公用户、开发者、设计师、内容创作者等。

## 三、核心功能设计

### 3.1 内置主题颜色
| 主题名称 | 背景色 | 描述 |
|----------|--------|------------------|
| 白色     | #f0f0f0 | 默认基础白色主题  |
| 护眼     | #A6C9AB | 柔和绿色，缓解疲劳 |
| 黄色     | #E4DFCD | 类纸背景，适合阅读 |
| 夜间     | #0D1117 | 深色背景，适合暗光环境 |

### 3.2 页面悬浮按钮

- 持续悬浮在网页侧边中部，具备吸附行为
- 支持拖动放置，自动吸附到最近侧边（左右）
- 点击弹出主题切换面板
- 在当前页面即时切换并保存设置

### 3.3 设置页面功能

- 网站列表：显示每个已设置网站的当前主题
- 增加、删除、修改指定网站的主题设置
- 支持用户添加自定义主题（扩展）
- 导入/导出配置为 JSON
- 支持恢复默认设置
- 错误导入自动回退并提示错误原因
- 所有配置保存在 `chrome.storage.local`

### 3.4 页面主题替换机制

- 自动注入 `content-script`，根据当前域名查找主题
- 将主题类添加到 `<html>` 或 `<body>`
- 所有主题样式由统一 `theme.css` 控制
- 使用 CSS 变量控制背景/文字色
- 忽略 `<iframe>` 与 `<canvas>` 内容处理
- 使用 `MutationObserver` 监控页面 DOM 变化并应用样式
- 响应系统 `prefers-color-scheme` 深色模式设置

## 四、非功能性需求

| 类型     | 说明 |
|----------|------|
| 性能     | 插件脚本注入不超过 100ms，Observer 限定监控范围 |
| 安全     | 不上传任何用户数据，配置保存在本地存储 |
| 可访问性 | UI 支持键盘操作、高对比度字体、ARIA 标签 |
| 错误处理 | 导入错误配置自动还原默认设置并提示 |
| 稳定性   | 页面刷新、跳转等场景下仍保持配置有效 |

## 五、配置结构示例

\`\`\`json
{
  "version": "1.0.0",
  "themes": {
    "example.com": "theme-night",
    "baidu.com": "theme-yellow"
  },
  "customThemes": {
    "theme-softgreen": {
      "bgColor": "#CFEAD3",
      "textColor": "#333333"
    }
  }
}
\`\`\`

## 六、技术架构

| 层级           | 模块                            |
|----------------|---------------------------------|
| 前端 UI        | React + Vite + TypeScript       |
| 插件架构       | Chrome Extension Manifest V3    |
| 页面注入       | Content Script + DOM Observer   |
| 样式管理       | CSS 变量 + 动态类名切换        |
| 数据存储       | `chrome.storage.local`          |
| 配置管理       | JSON 导入导出、自定义主题解析  |

## 七、UI 草图（Figma 风格）

- 悬浮按钮可拖动，释放后自动吸附边缘
- 弹出主题切换面板展示四种内置主题
- 设置页面包含：域名列表、主题映射表格、自定义主题添加、导出/导入、恢复默认按钮等

🖼 UI 草图示意图（已生成）：
📎 [点击查看草图下载图像文件](sandbox:/mnt/data/A_wireframe_digital_illustration_displays_two_UI_c.png)

## 八、功能流程图

（描述组件交互流程）

\`\`\`plaintext
用户操作浏览器页面
       ↓
点击悬浮按钮
       ↓
选择内置主题
       ↓
插件应用 CSS 类名到页面
       ↓
更新设置到 storage
       ↓
监听懒加载内容变动
       ↓
自动补充主题样式
\`\`\`

## 九、功能测试与验收标准

| 功能项         | 验收标准 |
|----------------|----------|
| 主题切换       | 用户切换后页面立即生效，无闪屏 |
| 设置页面保存   | 配置保存后刷新页面仍有效 |
| 悬浮按钮拖动   | 拖动释放后自动吸附边缘 |
| 自定义主题     | 正确渲染自定义配色项 |
| 导入导出       | 成功提示或错误回退，防止数据损坏 |
| iframe/canvas 忽略 | 插件不会干扰 iframe 或 canvas |
| 深色模式适配   | 浏览器系统切换后仍保留用户主题或配合切换 |

## 十、版本计划

| 版本号 | 主要内容 |
|--------|-----------|
| v1.0   | 基础功能实现：内置主题、拖动按钮、配置页、导入导出、懒加载处理 |
| v1.1   | 自定义快捷键、UI 国际化、主题渐变动画等 |
| v1.2+  | 云同步配置、自定义域名匹配规则、定时切换模式等 |